{"version":3,"sources":["app.jsx"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["let pressedKeys = new Set();\n\nconst SudokuGrid = props => {\n    const [cellValues, setCellValues] = React.useState(Array(81).fill(undefined));\n    const [cellLocks, setCellLocks] = React.useState(Array(81).fill(false));\n    const [cellAnnotations, setCellAnnotations] = React.useState(\n        Array(81).fill(\n            Array(9).fill(false)\n        ));\n    const [worker, setWorker] = React.useState(undefined);\n    const cells = React.useRef([]);\n\n    const isIdle = () => worker === undefined;\n    const lock = () => setCellLocks(cellValues.map(v => v !== undefined));\n    const unlock = () => setCellLocks(Array(81).fill(false));\n    const solve = () => {\n        if (isIdle()) {\n            // start a new computation with a webworker\n            let newWorker = new Worker('solver.js');\n            newWorker.postMessage({command: \"solve\", values: cellValues});\n\n            newWorker.onmessage = event => {\n                if (event.data !== undefined) {\n                    setCellValues(event.data);\n                }\n                newWorker.terminate();\n                setWorker(undefined);\n            };\n            setWorker(newWorker);\n        } else {\n            // stop current computation\n            worker.terminate();\n            setWorker(undefined);\n        }\n    };\n\n    /**\n     * Solve the grid with current values\n     * This method calls a Webworker in the background to run the search algorithm\n     */\n    const generate = () => {\n        if (isIdle()) {\n            // start a new computation with a webworker\n            let newWorker = new Worker('./solver.js');\n            newWorker.postMessage({command: \"generate\"});\n\n            newWorker.onmessage = event => {\n                if (event.data !== undefined) {\n                    setCellValues(event.data);\n                    setCellLocks(event.data.map(v => v !== undefined));\n                }\n                worker.terminate();\n                setWorker(undefined);\n            };\n            setWorker(newWorker);\n        } else {\n            // stop current computation\n            worker.terminate();\n            setWorker(undefined);\n        }\n    };\n\n    /**\n     * Unset the value for all unlocked cells\n     */\n    const clear = () => {\n        if (isIdle()) {\n            setCellValues(cellValues.map((v, i) => cellLocks[i] ? v : undefined));\n        }\n        for (let cell of cells) {\n            cell.setState({ small: Array(9).fill(false) });\n        }\n    };\n\n    const changeCellValue = (index, value) => {\n        if (!cellLocks[index]) {\n            let values = [...cellValues];\n            values[index] = value;\n            setCellValues(values);\n        }\n    };\n\n    return (\n        <div>\n            <div className=\"grid\" tabIndex=\"0\">\n                { cellValues.map((v, i) =>\n                    <Cell\n                        key={i}\n                        index={i}\n                        value={v}\n                        isLocked={cellLocks[i]}\n                        setValue={v => changeCellValue(i, v)}\n                        forwardRef={(input) => cells.current[i] = input}\n                    />\n                )}\n            </div>\n            <div id=\"buttons\">\n                <button onClick={generate}>{isIdle() ? \"Generate\" : \"Stop\"}</button>\n                <button onClick={clear}>Clear</button>\n                <button onClick={solve}>{isIdle() ? \"Solve\" : \"Stop\"}</button>\n                <button onClick={lock}>Lock</button>\n                <button onClick={unlock}>Unlock</button>\n            </div>\n        </div>\n    );\n};\n\nconst Cell = props => {\n    const [small, setSmall] = React.useState(Array(9).fill(false));\n\n    let pointerTimer = undefined;\n    let pointerValue = undefined;\n\n    const clearPointerTimer = () => {\n        clearTimeout(pointerTimer);\n        pointerTimer = undefined;\n    };\n\n    const onPointerDown = (event, value) => {\n        if (!props.isLocked) {\n            if (pointerTimer !== undefined) {\n                clearPointerTimer();\n            }\n            pointerTimer = setTimeout(() => {\n                console.log(pointerValue);\n                props.setValue(pointerValue);\n                clearPointerTimer();\n            }, 250);\n            pointerValue = value;\n        }\n    };\n\n    const onPointerUp = (event, value) => {\n        if (pointerTimer !== undefined) {\n            clearPointerTimer();\n            let newSmall = Array.from(small);\n            newSmall[value] = !newSmall[value];\n            setSmall(newSmall);\n        }\n    };\n\n    const onPointerLeave = (event) => clearPointerTimer();\n\n    let row = ~~(props.index / 9);\n    let col = props.index % 9;\n    let area = 3 * ~~(row / 3) + ~~(col / 3);\n    let classes = ['cell', `R${row}`, `C${col}`, `A${area}`];\n    if (props.isLocked) classes.push(\"locked\");\n    let smallNotes = [];\n    if (props.value === undefined) {\n        for (let i = 1; i <= 9; i++) {\n            smallNotes.push(\n                <div\n                    className=\"small\"\n                    onMouseDown={e => onPointerDown(e, i)}\n                    onMouseLeave={() => onPointerLeave()}\n                    onMouseUp={e => onPointerUp(e, i)}\n                    onPointerDown={e => onPointerDown(e, i)}\n                    onPointerLeave={() => onPointerLeave()}\n                    onPointerUp={e => onPointerUp(e, i)}\n                    key={i}>\n                    {small[i] ? i : \"\"}\n                </div>);\n        }\n    }\n    return (\n        <div className={classes.join(' ')}>\n            <div\n                className=\"big\"\n                onTouchStart={() => {props.setValue(undefined)}}\n                onMouseDown={() => {props.setValue(undefined)}}>\n                { props.value }\n            </div>\n            { smallNotes }\n        </div>\n    );\n};\n\nwindow.oncontextmenu = function(event) {\n    event.preventDefault();\n    event.stopPropagation();\n    return false;\n};\n\ndocument.addEventListener(\"keydown\", event => { pressedKeys.add(event.key); });\ndocument.addEventListener(\"keyup\", event => { pressedKeys.delete(event.key); });\n\nReactDOM.render(\n    <SudokuGrid />,\n    document.getElementById('app')\n);\n\n"]}